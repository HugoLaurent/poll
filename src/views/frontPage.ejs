<%- include('./partials/header') %>
<h2 class="category-title">Most Popular</h2>
<main>
      
    
<% for(const poll of polls) { %>

    
    <article class="poll-container">
            <form method="POST" action="/">
                <% const pourcentA = Math.round((poll.result_a /(poll.result_a + poll.result_b)) * 100) %>
                <% const pourcentB = Math.round((poll.result_b /(poll.result_a + poll.result_b)) * 100) %>
            <div class="poll-header">                
                <h2 class="poll-header-title"><%= poll.title %></h2>
                <p class="poll-header-author"><%= poll.author.pseudo %></p>
            </div>
            <p class="poll-question"><%= poll.question %></p>
            
                <div class="poll-wrapper">
                    <input class="poll-wrapper-checkbox" type="checkbox" id="first" name="choice" value="result_a">
                    <div class="poll-progressbar-wrapper">
                        <div class="poll-progressbar" style="width: <%=pourcentA%>%" title="first_choice">
                            <p class="poll-progressbar"><%= poll.choice_a %></p>
                        </div>
                    </div>
                    <span class="poll-progressbar-pourcent"><%=pourcentA%>%</span>
                </div>
                <div class="poll-wrapper">
                    <input class="poll-wrapper-checkbox" type="checkbox" id="second" name="choice" value="result_b">          
                    <div class="poll-progressbar-wrapper">
                        <div class="poll-progressbar" style="width: <%=pourcentB%>%" title="second_choice" >
                            <p><%= poll.choice_b %></p>
                        </div>
                    </div>
                    <span class="poll-progressbar-pourcent"><%=pourcentB%>%</span>
                </div>               
            <div class="poll-footer">
                <div class="poll-footer-share">
                    <img class="share-button" src="/images/share.svg" alt="">
                    <span class="coming-soon"></span>
                    <input type="hidden" id="id" name="id" value="<%=poll.id%>">
                </div>                              
                <p class="poll-footer-vote"><%=poll.result_a + poll.result_b %> votes</p>                                
                <% if(!votes.includes(poll.id)) {%>
                <button class="article-button" type="submit">Validate</button>
                <% } %>  
            </div>
        </form>
        </article>
<% } %> 
    
    <!-- POP UP FOR THE SIGN UP FORM -->
    <%- include('partials/signup.ejs') %>

    <!-- POP UP FOR THE CONNECT FORM -->
    <%- include('partials/connect.ejs') %>

    <!-- POP UP FOR THE CREATE FORM -->
    <section class="create form">
        <span class="to-close-create">x</span>
        <h1>Create a poll</h1>
                <form class="popup" action="" method="POST">
                    <ul>
                        <li><input placeholder="Title of your poll" type="text"></li>
                        <li><input placeholder="The question of your poll" type="text"></li>
                        <li><input placeholder="First choice" type="text"></li>
                        <li><input placeholder="Second choice" type="text"></li>
                    </ul>
                    <% if (locals.user) { %>
                    <button type="submit">Validate</button>
                    <% } else { %>
                        <p style="color:red">Plz signup before create poll</p>
                    <% } %>
                </form>
    </section>
</main>


<%- include('./partials/footer') %>   