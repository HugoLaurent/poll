<%- include('./partials/header') %>
<h2 class="category-title">Popular</h2>
<main>
    
    <% if(locals.errorMessage) { %>
        <p><%= errorMessage %></p>
        <% } %>

    
<% for(const poll of polls) { %>

    
    <article class="poll-container">
            <form method="POST" action="/">
                <% const pourcentA = Math.round((poll.result_a /(poll.result_a + poll.result_b)) * 100) %>
                <% const pourcentB = Math.round((poll.result_b /(poll.result_a + poll.result_b)) * 100) %>
            <div class="poll-header">                
                <h2 class="poll-header-title"><%= poll.title %></h2>
                <p class="poll-header-author"><%= poll.author.pseudo %></p>
            </div>
            <p class="poll-question"><%= poll.question %></p>
            
                <div class="poll-wrapper">
                    <input class="poll-wrapper-checkbox" type="checkbox" id="first" name="choice" value="result_a">
                    <div class="poll-progressbar-wrapper">
                        <div class="poll-progressbar" style="width: <%=pourcentA%>%" title="first_choice">
                            <p class="poll-progressbar"><%= poll.choice_a %></p>
                        </div>
                    </div>
                    <span class="poll-progressbar-pourcent"><%=pourcentA%>%</span>
                </div>
                <div class="poll-wrapper">
                    <input class="poll-wrapper-checkbox" type="checkbox" id="second" name="choice" value="result_b">          
                    <div class="poll-progressbar-wrapper">
                        <div class="poll-progressbar" style="width: <%=pourcentB%>%" title="second_choice" >
                            <p><%= poll.choice_b %></p>
                        </div>
                    </div>
                    <span class="poll-progressbar-pourcent"><%=pourcentB%>%</span>
                </div>               
            <div class="poll-footer">
                <div class="poll-footer-share">
                    <img class="share-button" src="/images/share.svg" alt="">
                    <span class="coming-soon"></span>
                    <input type="hidden" id="id" name="id" value="<%=poll.id%>">
                </div>                              
                <p class="poll-footer-vote"><%=poll.result_a + poll.result_b %> votes</p>                                
                <% if(!votes.includes(poll.id)) {%>
                <button class="article-button" type="submit">Validate</button>
                <% } %>  
            </div>
        </form>
        </article>

<% } %> 
    
    <!-- POP UP FOR THE SIGN UP FORM -->
    <section class="sign-up form">
        <span class="to-close">x</span>
        <h1>Inscription Form</h1>
            <form class="popup" action="/signup" method="POST">              
                <ul>
                    <li><input type="pseudo" id="pseudo" name="pseudo" placeholder=" Pseudo"  ></li>
                    <li><input type="firstname" id="firstname" name="firstname" placeholder=" Firstname" ></li>
                    <li><input type="lastname" id="lastname" name="lastname" placeholder=" Lastname"  ></li>                    
                    <li><input type="email" id="email" name="email" placeholder=" E-mail" ></li>
                    <li><input type="password" id="password" name="password" placeholder=" Password" ></li>
                    <li><input type="password" id="confirmation" name="confirmation" placeholder=" Confirmation" ></li>
                </ul>
                <ul class="conditions">
                    <li><input class="private" type="checkbox">I accept the conditions of the following articles: <a style="text-decoration: none; "href="https://eur-lex.europa.eu/legal-content/EN/TXT/HTML/?uri=CELEX:32016R0679&from=EN">   Official Journal </a>--<a style="text-decoration: none; "href="https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:C:2010:083:0389:0403:EN:PDF"> EU Charter </a></li>
                    <li> and i agree to poll's storage terms</li>
                </ul>
                <button type="submit">Validate</button>
            </form>
    </section>

    <!-- POP UP FOR THE CONNECT FORM -->

    <section class="connect form">
        <span class="to-close-connect">x</span>
        <h1>Connect Form</h1>
        <form class="popup" action="" method="POST">
            <ul>
                <li><input placeholder="Pseudo" type="text"></li>
                <li><input placeholder="Password" type="text"></li>
            </ul>
            <button type="submit">Connect</button>
        </form>
    </section>

    <!-- POP UP FOR THE CREATE FORM -->

    <section class="create form">
        <span class="to-close-create">x</span>
        <h1>Create a poll</h1>
                <form class="popup" action="" method="POST">
                    <ul>
                        <li><input placeholder="Title of your poll" type="text"></li>
                        <li><input placeholder="The question of your poll" type="text"></li>
                        <li><input placeholder="First choice" type="text"></li>
                        <li><input placeholder="Second choice" type="text"></li>
                    </ul>
                    <button type="submit">Validate</button>
                </form>
    </section>
</main>


<%- include('./partials/footer') %>   